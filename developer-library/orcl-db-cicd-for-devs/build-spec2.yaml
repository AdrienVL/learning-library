version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash
env:

  exportedVariables:
    - version

steps:
  - type: Command
    name: "Update Java, install SQLcl and run liquibase on the DB"
    command: |
      oci db autonomous-database create --compartment-id "ocid1.compartment.oc1..aaaaaaaaczhxqayl7sb2eb6lrbs5qmlbbxmca5gwrx3bby4wwhpqgeahxz3a" --cpu-core-count 1 --data-storage-size-in-tbs 1 --db-name "DEVOP1" --display-name "DEVOP1" --db-workload "OLTP"  --admin-password "WElcome11##11"
      yum update java -y
      wget https://download.oracle.com/otn_software/java/sqldeveloper/sqlcl-latest.zip
      unzip sqlcl-latest.zip
      ./sqlcl/bin/sql test/PAssW0rd11##11@152.70.186.226:1521/test19.publicsubnet.demos.oraclevcn.com @lb.sql

  - type: Command
    name: "Pack the database items in zip format"
    command: |
      zip -r code.zip database/*

  - type: Command
    name: "Does OCI CLI Exist?"
    command: |
      echo "Does OCI CLI Exist?"
      oci os ns get


outputArtifacts:
  - name: code
    type: BINARY
    location: code.zip




